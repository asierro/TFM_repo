% Chapter 1

\chapter{Theoretical and computational tools} % Main chapter title
% Theory and programs?

\label{Chapter1} % For referencing the chapter elsewhere, use \ref{Chapter1} 

%----------------------------------------------------------------------------------------

% Define some commands to keep the formatting separated from the content 
\newcommand{\keyword}[1]{\textbf{#1}}
\newcommand{\tabhead}[1]{\textbf{#1}}
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\file}[1]{\texttt{\bfseries#1}}
\newcommand{\option}[1]{\texttt{\itshape#1}}

%----------------------------------------------------------------------------------------
\section{Density Functional Theory}

Density-functional theory (DFT) is an approach to study the electronic structure of many-body problems, which allows the computational treatment large and complex systems. In fact, one of the reasons why DFT has become an essential tool in many areas of physics including condensed-matter theory is the increasing availability and power of computational processing. DFT is mainly based on the fact that any property of a system of many interacting particles can be viewed as a functional of the ground state
density [**martin]. The famous paper by Hohenberg and Kohn in 1964 [** in martin] laid the groundwork of modern DFT, while the formulation presented in a 1965 paper by Kohn and Sham [** in martin] has prevailed as one of the most useful approaches up to this day. In the following subsections we will present the basics of this method, and then review a specific implementation, namely SIESTA, which will be used throughout this work.


\subsection{Basics of DFT}
The main problem to be solved is the many-body time-independent Schr√∂dinger's equation, in the spin-unpolarized case:
\begin{equation}
\bm H \ket{\Psi(\{\bm r\},\{\bm R\})} = E \ket{\Psi(\{\bm r\},\{\bm R\})},
\end{equation}

where \(\{\bm r\}\) and \(\{\bm R\}\) are the electron and ion position vectors, respectively. The most basic Hamiltonian contains a kinetic term plus a potential energy term describing two particle interactions: electron-ion, electron-electron and ion-ion [** martin]:
\begin{equation}
\begin{split}
\bm{H} &= \bm T_{\mathrm e} + \bm V_{\mathrm{en}}+\bm V_{\mathrm{ee}}+\bm T_n+\bm V_{\mathrm{nn}}\\
&= -\frac{\hbar^2}{2m_{\mathrm{e}}}\sum_i\nabla_i^2-\sum_{i,I}\frac{Z_Ie^2}{\abs{\bm r_i-\bm R_i}} + \frac 1 2 \sum_{i\neq j}\frac{e^2}{\abs{\bm r_i-\bm r_j}}\\
&\quad-\sum_I\frac{\hbar^2}{2M_I}\nabla_I^2+\frac 1 2 \sum_{I\neq J}\frac{Z_IZ_Je^2}{\abs{\bm R_I-\bm R_J}},
\end{split}
\end{equation}

which after the well-known Born-Oppenheimer approximation [** martin], whereby electrons are adiabatically separated from ions owing to their large mass difference, can be replaced with
\begin{equation}
\bm{H}\equiv\bm H_{\mathrm e} = \bm T_{\mathrm e} + \bm V_{\mathrm{en}}+\bm V_{\mathrm{ee}},
\end{equation}


so that the corresponding electron eigenfunctions only depend on \(\{\bm R\}\) parametrically. As the name implies, DFT is based upon electron density rather than the explicit wavefunctions, and it does so through two theorems first proved by Hohenberg and Kohn [** martin], which we will now describe. The ground-state wavefunction satisfies\footnote{Note that we write \(\bm V_{\mathrm{ext}}\) instead of the electron-ion potential for generality, but the former usually includes the latter.}
\begin{equation}
\bm H \ket{\Psi_0}=(\bm T_{\mathrm e} + \bm V_{\mathrm{ext}}+\bm V_{\mathrm{ee}})\ket{\Psi_0}=E_0\ket{\Psi_0},
\end{equation}

so along with the ground-state energy it is determined by the external potential Therefore, so is the density, since the wavefunction is a unique functional of this quantity by the relation [** Solyom]

\begin{equation}
	n_{\mathrm{e}}(\bm{r})=N_{\mathrm{e}} \int \mathrm{d} \bm{r}_{2} \cdots \int \mathrm{d} \bm{r}_{N_{\mathrm{e}}}\left|\Psi\left(\bm{r}, \bm{r}_{2}, \ldots, \bm{r}_{N_{\mathrm{e}}}\right)\right|^{2}
\end{equation}

where \(N_{\mathrm{e}}\) is the total number of electrons. The first Hohenberg-Kohn theorem states that this relationship between the external potential and the density is bilateral.

\begin{theorem}
The ground-state wavefunction \(\ket{\Psi_0}\), and hence the ground-state expectation values of any observable, is a unique functional of the ground-state density \(n_{\mathrm e}(\bm{r})\).
\end{theorem}

Thus, \(n_{\mathrm e}(\bm r)\) univocally determines \(\bm V_{\mathrm{ext}}\), and so we can write the following functional relation
\begin{equation}
	\label{en-fal}
	E\left[n_{\mathrm{e}}(\bm{r})\right]=F\left[n_{\mathrm{e}}(\bm{r})\right]+\int\mathrm{d} \bm{r}\, V_{\mathrm{ext}}(\bm{r}) n_{\mathrm{e}}(\bm{r}),
\end{equation}

where \(F\) is the Hohenberg-Kohn functional defined by [** papi]
\begin{equation}
\begin{split}
F\left[n_{\mathrm{e}}(\bm{r})\right]&=\expval{\bm T_{\mathrm e}+\bm V_{\mathrm{ee}}}{\Psi_0}=T_{\mathrm e}\left[n_{\mathrm{e}}(\bm{r})\right]+E_{\mathrm{ee}}\left[n_{\mathrm{e}}(\bm{r})\right]\\
&=T_{\mathrm e}\left[n_{\mathrm{e}}(\bm{r})\right]+E_{\mathrm{H}}\left[n_{\mathrm{e}}(\bm{r})\right]+E_{\mathrm{Q}}\left[n_{\mathrm{e}}(\bm{r})\right],
\end{split}
\end{equation}

where we detach from the electron-electron interaction energy the Hartree term, which describes the classical self-interaction of the electron density:
\begin{equation}
E_{\mathrm{H}}\left[n_{\mathrm{e}}(\bm{r})\right]=\frac {e^2} 2 \int\D\bm r\D\bm{r}'\frac{n_{\mathrm{e}}(\bm{r})n_{\mathrm{e}}(\bm{r}')}{\abs{\bm{r} - \bm{r}'}},
\end{equation}

and express the rest as a non-classical part. Without prior knowledge of the ground-state density, one may find it using the second Hohenberg-Kohn theorem, which is based on the variational principle.

\begin{theorem}
The energy as a functional of some trial density takes its minimum at the true ground-state density.
\end{theorem}

Thus, the ground-state energy satisfies
\begin{equation}
E_0=\min E[n_{\mathrm e}(\bm r)],\quad \mathrm{with}\quad \int \D\bm r\, n_{\mathrm e}(\bm{r})=N_e.
\end{equation}

However, this minimization cannot be easily carried out in practice, due to the many-body nature of the problem which hinders finding the form of the Hohenberg-Kohn functional. Moreover, even though the density is in principle sufficient to extract any other property of the material, there is no feasible algorithm to do it in the exact case [** martin]. 

\subsubsection*{Kohn-Sham equations}
In order to circumvent this problem, Kohn and Sham proposed a way to approximate this functional[** in martin]. The main idea is to replace the interacting system with a non-interacting one, where a functional for the kinetic energy is known, and which contains an effective one-particle potential \(V_{\mathrm{eff}}\) such that the original density is reproduced. Therefore, the individual particles in this auxiliary problem satisfy
\begin{equation}
\label{ks-eq}
\left(-\frac1 2+\nabla^2+V_{\mathrm{eff}}(\bm r)\right)\psi^{\mathrm{KS}}_i=\epsilon_i \psi^{\mathrm{KS}}_i,
\end{equation}

so that the total auxiliary wavefunction \(\ket{\Psi_{\mathrm{KS}}}\) is given by the Slater determinant of these one-particle wavefunctions. The density is then given by
\begin{equation}
	n_{\mathrm{e}}(\bm r)=\sum^{N_{\mathrm e}}_{i=1}\abs{\psi_i^{\mathrm{KS}}(\bm r)}^2,
\end{equation}

and the kinetic energy functional in this system is now
\begin{equation}
T_{\mathrm{KS}}=\expval{T}{\Psi_{\mathrm{KS}}}=\frac1 2\sum_{i=1}^{N_{\mathrm e}}\int\D\bm r\abs{\nabla\psi_i^{\mathrm{KS}}(\bm r)}^2.
\end{equation}

This is of course different from the many body kinetic energy, because we have neglected many body effects. Since the density is the same in both problems, these can be taken into account via the so-called exchange-correlation energy, defined as
\begin{equation}
E_{\mathrm{xc}}[n_{\mr e}]=T_{\mr e}[n_{\mr e}]-T_{\mr{KS}}[n_{\mr e}]+E_{\mr Q}[n_{\mr e}].
\end{equation}

Thus, the Hohenberg-Kohn functional reads
\begin{equation}
F[n_{\mr e}]=T_{\mr{KS}}[n_{\mr e}]+E_{H}[n_{\mr e}]+E_{\mr{xc}}[n_{\mr e}],
\end{equation}

so the minimization of the energy functional \ref{en-fal} reveals that[**martin]
\begin{equation}
V_{\mathrm{eff}}=V_{\mr{ext}}(\bm r)+e^2\int\D\bm r'\frac{n_{\mr e}(\bm r')}{\abs{\bm r-\bm r'}}+V_{\mr{xc}}[n_{\mr e}],
\end{equation}

where the middle term is the Hartree potential \(V_{H}[n_{\mr e}]\). Then, if the exchange-correlation potential were known, the Kohn-Sham equation \ref{ks-eq} could be solved self-consistently, by using an initial guess of \(n_{\mr e}\), calculating \(V_{\mr{eff}}\) with it, solving the Kohn-Sham equations to obtain the wavefunctions which define \(n_{\mr e}\), and so on until convergence is reached.\\

However, the exact form for \(E_{\mr{xc}}\) is unknown[** martin], so DFT is reduced to finding the useful approximations. The simplest approximation is the local-density approximation (LDA)[**ks in kretz] which assumes \(E_{\mr{xc}}\) only depends on the density locally, that is, the density never simultaneously evaluated at two points (\(\bm r\) and \(bm r'\)) inside the integral. Another widely used approximation is the generalized-gradient approximation (GGA)[**martin], where the gradient is also allowed to appear inside the integral, which introduces some non-locality. Throughout this work we will be using the PBE[** in kretz] flavour of GGA.

% exact Exc functionals actually not known, approximations lda gga... papior + kretz

\subsection{SIESTA}
SIESTA[** siesta paper] is an implementation of DFT that solves the Kohn-Sham equations. This code describes the effect of core electrons using soft norm-conserving pseudopotentials, and uses a basis set of numerical atomic orbitals with finite range to represent the electronic structure of valence electrons. All while keeping calculations of order \(N\) (\(\mathcal O(N)\)) with respect to system size (number of atoms).

\subsubsection*{Pseudopotentials}
The one particle KS equation presents the numerical difficulty of dealing accurately with both core and valence electrons. Core electrons are those that do not participate in chemical bonding. Core eigenvalues are much lower than valence eigenvalues, and their wavefuntions are highly localized around the nuclei, which make them chemically inert.\\

Regarding valence electrons, the hermiticity of the Hamiltonian means their wavefunctions are orthogonal to the core wavefunctions. Therefore, the Fourier expansion of their wavefunction has a big contribution of short wavelengths near the nucleus, and in order to get a good approximation a large number of plane waves (or a denser real-space grid) would be needed, which makes calculations more expensive.\\

In order to overcome this problem, the dynamics of the core electrons is ignored and their effect is replaced by an effective potential. The effect of core electrons on valence wavefunctions can then be eliminated by replacing the oscillating part near the nucleus by a smoother function. This is done by defining an adequate pseudopotential.\\

Given a reference atomic configuration, Hammann \textit{et al} give a few requirements an adequate pseudopotential must meet[**Hamann], which ensure the smoothness and transferability of the pseudopotential. While satisfying these, the user has freedom to specify their desired pseudopotential. In this work, we will use GGA-PBE pseudopotentials from ***website.
%\begin{enumerate}
%\item All electron and pseudo valence eigenvalues agree for the chosen configuration.
%\item All electron and pseudo valence wavefunctions agree beyond a chosen cutoff radius Rc.
%\item The logarithmic derivatives of the all-electron and pseudo-wavefunctions agree at Rc
%\item The integrals from 0 to r of the real and pseudo charge densities agree for r > Rc for each valence state (norm conservation).
%\end{enumerate}


Local and non-local parts -> reason... order n (telaviv pseudopotentials) so Ks eq with the kb projectos et is:

\subsubsection*{Basis sets}
tel-aviv basis sets.
Expand in terms of a finite set of basis functions: (ks)

Plane wave, advantage disadvantage

Pseudo atomic orbitals, siesta
phi R Ylm

adv disdvantage. SIESTA -> any PAO (add abbrev) as long as it has that form and R is finite.

Minimal basis, or single-z...

Radial flexibility, multiple zeta. In this work we mainly use the DZP (add abbreviation) basis set... (explain what is double-zeta and why polarized)

\subsubsection{Some internal details}
very general matrix elements, integrals (-> fft -> repetition)
Density matrix, used for many calculations
scf convergence, mixing (pulay)

Infinite periodic solids -> supercell + Bon-Von karman bc,
k-dependent mat els, k point sampling, MonkHorst pack

% Paragraph: forces
% in equation 1.3 we have neglected the ion energy E_II, but we see it contributes to total energy, different {R_I} -> diff energies -> minimization to relax the structure
% conjugate gradients

%----------------------------------------------------------------------------------------

%\section{Transport through NEGF}
%
%In this section the theory of nonequilibrium Green's functions (NEGF) will be presented, as the underlying theory of various programs that will be used (\textsc{TranSIESTA} *** and \textsc{TBrans}***) to study transport properties of the desired materials. Knowledge of (first- and second-quantized) quantum mechanics  will be assumed, and the starting point will be an equilibrium state, which will lay the foundations and the basic properties of Green's functions. We will then delve into NEGF through the Keldysh formalism, and afterwards explore a simple and conceptually useful reformulation of this theory by S. Datta \textit{et al}***. Finally, we will overview the implementation in \textsc{TranSIESTA}.
%
%
%\subsection{Equilibrium Green's functions}
%
%
%\subsection{Keldysh formalism}
%\subsection{TranSIESTA and TBtrans}
%\subsection{sisl}


